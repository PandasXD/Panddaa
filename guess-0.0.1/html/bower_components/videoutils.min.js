VideoUtils=function(n,e){function o(n,o){o&&n.unsubscribe(o).then(function(){console.log("Unsubscribed camera"),o=null},e.onQimError)}function r(n,e,o,r,t){if(d){for(var l=0,i=0;i<r;i++)for(var a=0;a<o;a++){var u=e[l++],s=u/255;s=1-(1-s)*(1-s),u=Math.floor(256*s);for(var c=0;c<y;c++)for(var f=0;f<p;f++){var m=o*y*(p*i+f)+(o*y-y*a-c-1);v[m]=255<<24|u<<16|u<<8|u}}g.data.set(h),d.putImageData(g,0,0)}}function t(n,o){I&&n.getImageRemote(o).then(function(i){if(i){var a=i[0],c=i[1];r(f,i[6],a,c,s),n.releaseImage(o).then(function(){l=setTimeout(t(n,o),1e3/u)},e.onQimError)}else console.log("no image")},e.onQimError)}var l,i,a,u=null,s=null,c=null,f=null,m=null,d=null,g=null,b=null,h=null,v=null,y=1,p=1,w={0:[160,120],1:[320,240],2:[640,480],3:[1280,960]},I=!0;return n.unsubscribeAllHandlers=function(n,e){return new Promise(function(r,t){console.log("trying to unsubscribe all related handlers..."),promises=[];for(var l=0;l<5;l++)promises[l]=new Promise(function(r,t){o(n,e+"_"+l),r()});Promise.all(promises).then(function(){r(e)},t)})},n.startVideo=function(n,e,o,r,l){u=r,l=l,c=o,f=document.getElementById(e),m=e+"_camera",d=f.getContext("2d"),g=d.createImageData(w[o][0],w[o][1]),b=new ArrayBuffer(g.data.length),h=new Uint8ClampedArray(b),v=new Uint32Array(b),a=n,I=!0,console.log("play"),n.subscribeCamera(m,0,c,l,u).then(function(e){console.log("subscribed camera",e),i=e,a=n,setTimeout(function(){t(n,e)},0)},function(n){console.log(n)})},n.stopVideo=function(){try{I=!1,clearTimeout(l),o(a,i)}catch(n){}},n}(window.VideoUtils||{},jQuery);